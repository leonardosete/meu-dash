<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Análise de Alertas</title>
    <!-- Tailwind CSS para uma estilização rápida e moderna -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados e variáveis de cor para manter a consistência */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #12141D;
            color: #E0E0E0;
        }
        .card {
            background-color: #1B1E2C;
            border: 1px solid #3A3D5A;
        }
        .stat-card {
            background-color: #24273A;
            border: 1px solid #3A3D5A;
        }
        .file-input-wrapper {
            border: 2px dashed #3A3D5A;
        }
        .file-input-wrapper.drag-active {
            background-color: #24273A;
            border-color: #6A5AF9;
        }
        /* Animação para o spinner */
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Transições suaves para as telas */
        .view {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="p-5 md:p-8 min-h-screen flex items-center justify-center">

    <main id="app-container" class="w-full max-w-5xl mx-auto">

        <!-- =============================================================== -->
        <!-- VIEW: DASHBOARD (TELA INICIAL)                                  -->
        <!-- =============================================================== -->
        <div id="dashboard-view" class="view space-y-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white text-center">MeuDash</h1>

            <!-- Seção do Resumo -->
            <div class="dashboard-section card rounded-2xl p-6 md:p-8 shadow-2xl">
                <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Resumo da Última Análise</h2>
                    <p class="text-sm text-gray-400 mt-2 sm:mt-0">Dados de: 23/09/2025</p>
                </div>
                <div id="summary-content">
                    <!-- Conteúdo do resumo será inserido aqui pelo JS -->
                </div>
            </div>

            <!-- Seção de Upload -->
            <div class="upload-section max-w-2xl mx-auto">
                <div class="card rounded-2xl p-6 md:p-10 shadow-2xl text-center">
                    <h2 class="text-2xl font-semibold text-white mb-6">Nova Análise</h2>
                    <div id="upload-error" class="hidden text-red-400 bg-red-900/20 border border-red-500 p-4 rounded-lg mb-6 text-left">
                        <!-- Mensagem de erro -->
                    </div>
                    <form id="upload-form">
                        <label for="file-input" class="block font-medium mb-4 text-left text-lg">Selecione o arquivo de dados:</label>
                        <div id="file-wrapper" class="file-input-wrapper rounded-xl p-8 cursor-pointer transition-colors duration-300 mb-8">
                            <input type="file" id="file-input" class="hidden" required>
                            <div class="flex flex-col items-center justify-center">
                                <svg class="w-12 h-12 text-gray-500 mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3-3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>
                                <span id="file-text" class="text-gray-400">Clique ou arraste o arquivo aqui</span>
                                <span id="file-name" class="hidden mt-2 font-medium text-green-400"></span>
                            </div>
                        </div>
                        <button type="submit" id="submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 text-lg disabled:bg-gray-600 disabled:cursor-not-allowed">
                            Analisar Arquivo
                        </button>
                    </form>
                </div>
            </div>

            <!-- Seção de Links -->
            <div class="side-links grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Links serão inseridos aqui -->
            </div>
        </div>

        <!-- =============================================================== -->
        <!-- VIEW: STATUS (PROCESSANDO, SUCESSO, ERRO)                       -->
        <!-- =============================================================== -->
        <div id="status-view" class="view hidden">
            <div class="card rounded-2xl p-8 md:p-16 shadow-2xl text-center max-w-2xl mx-auto">
                <!-- Status: Processando -->
                <div id="status-pending">
                    <div class="spinner border-4 border-gray-600 border-t-indigo-500 rounded-full w-16 h-16 mx-auto mb-6"></div>
                    <h1 class="text-3xl font-bold text-white mb-3">Processando...</h1>
                    <p class="text-gray-400 text-lg">Sua análise está em andamento. Por favor, aguarde um momento.</p>
                </div>
                <!-- Status: Sucesso -->
                <div id="status-success" class="hidden">
                    <svg class="w-20 h-20 text-green-500 mx-auto mb-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <h1 class="text-3xl font-bold text-white mb-3">Análise Concluída!</h1>
                    <p class="text-gray-400 text-lg mb-8">O seu relatório foi gerado com sucesso e está pronto para visualização.</p>
                    <a id="report-link" href="#" class="inline-block bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 text-lg">Ver Relatório</a>
                </div>
                <!-- Status: Erro -->
                <div id="status-failed" class="hidden">
                    <svg class="w-20 h-20 text-red-500 mx-auto mb-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
                    <h1 class="text-3xl font-bold text-white mb-3">Ocorreu um Erro</h1>
                    <p id="error-message" class="text-gray-400 text-lg mb-8">Não foi possível processar seu arquivo. Por favor, tente novamente.</p>
                    <button id="retry-btn" class="inline-block bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 text-lg">Tentar Novamente</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- VARIÁVEIS E DADOS MOCKADOS ---
            const app = {
                views: {
                    dashboard: document.getElementById('dashboard-view'),
                    status: document.getElementById('status-view'),
                },
                statusPanels: {
                    pending: document.getElementById('status-pending'),
                    success: document.getElementById('status-success'),
                    failed: document.getElementById('status-failed'),
                },
                uploadForm: document.getElementById('upload-form'),
                fileInput: document.getElementById('file-input'),
                fileWrapper: document.getElementById('file-wrapper'),
                fileText: document.getElementById('file-text'),
                fileName: document.getElementById('file-name'),
                submitBtn: document.getElementById('submit-btn'),
                retryBtn: document.getElementById('retry-btn'),
                reportLink: document.getElementById('report-link'),
                errorMessage: document.getElementById('error-message'),
                uploadError: document.getElementById('upload-error'),
            };

            // Dados mockados para popular a interface
            const mockSummaryData = {
                total_alertas: 184,
                risco_medio: 7.42,
                ineficiencia_media: 5.11,
                impacto_medio: 6.89,
            };

            const mockLinks = [
                {
                    title: "Plano de Ação",
                    description: "Editar casos que precisam de atuação.",
                    url: "#",
                    color: "red",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7 flex-shrink-0"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`
                },
                {
                    title: "Ver Análise de Tendência",
                    description: "Comparativo com o período anterior.",
                    url: "#",
                    color: "green",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7 flex-shrink-0"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>`
                },
                {
                    title: "Histórico de Relatórios",
                    description: "Acessar todos os relatórios gerados.",
                    url: "#",
                    color: "gray",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7 flex-shrink-0"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>`
                }
            ];

            // --- FUNÇÕES ---

            // Função para trocar entre as telas (views)
            function showView(viewName) {
                Object.values(app.views).forEach(view => view.classList.add('hidden', 'opacity-0'));
                if (app.views[viewName]) {
                    app.views[viewName].classList.remove('hidden');
                    setTimeout(() => app.views[viewName].classList.remove('opacity-0'), 50);
                }
            }

            // Função para trocar os painéis de status (pending, success, failed)
            function showStatusPanel(statusName) {
                Object.values(app.statusPanels).forEach(panel => panel.classList.add('hidden'));
                if (app.statusPanels[statusName]) {
                    app.statusPanels[statusName].classList.remove('hidden');
                }
            }
            
            // Simula uma chamada de API para verificar o status
            function pollStatus() {
                console.log("Verificando status...");
                // Simula uma resposta da API após 3 segundos
                setTimeout(() => {
                    // Alterne entre 'success' e 'failure' para testar os dois cenários
                    const outcome = Math.random() > 0.3 ? 'success' : 'failure'; 
                    
                    if (outcome === 'success') {
                        showStatusPanel('success');
                        app.reportLink.href = '/path/to/your/generated/report.pdf';
                    } else {
                        app.errorMessage.textContent = 'O formato do arquivo é incompatível ou os dados estão corrompidos.';
                        showStatusPanel('failed');
                    }
                }, 3000);
            }

            // Lógica para o campo de upload
            function setupFileInput() {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    app.fileWrapper.addEventListener(eventName, e => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    app.fileWrapper.addEventListener(eventName, () => app.fileWrapper.classList.add('drag-active'));
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    app.fileWrapper.addEventListener(eventName, () => app.fileWrapper.classList.remove('drag-active'));
                });

                app.fileWrapper.addEventListener('click', () => app.fileInput.click());

                app.fileWrapper.addEventListener('drop', e => {
                    if (e.dataTransfer.files.length > 0) {
                        app.fileInput.files = e.dataTransfer.files;
                        app.fileInput.dispatchEvent(new Event('change'));
                    }
                });
                
                app.fileInput.addEventListener('change', () => {
                    if (app.fileInput.files.length > 0) {
                        app.fileName.textContent = app.fileInput.files[0].name;
                        app.fileName.classList.remove('hidden');
                        app.fileText.classList.add('hidden');
                    } else {
                        app.fileName.classList.add('hidden');
                        app.fileText.classList.remove('hidden');
                    }
                });
            }

            // Lógica para o envio do formulário
            app.uploadForm.addEventListener('submit', function(e) {
                e.preventDefault();
                app.uploadError.classList.add('hidden');

                if (app.fileInput.files.length === 0) {
                    app.uploadError.textContent = "Por favor, selecione um arquivo para continuar.";
                    app.uploadError.classList.remove('hidden');
                    return;
                }
                
                app.submitBtn.disabled = true;
                app.submitBtn.textContent = 'Processando...';

                showView('status');
                showStatusPanel('pending');
                pollStatus(); // Inicia a verificação do status
            });
            
            // Lógica do botão "Tentar Novamente"
            app.retryBtn.addEventListener('click', () => {
                // Resetar o estado do formulário
                app.uploadForm.reset();
                app.fileInput.dispatchEvent(new Event('change'));
                app.submitBtn.disabled = false;
                app.submitBtn.textContent = 'Analisar Arquivo';
                showView('dashboard');
            });
            
            // Função para popular o dashboard com dados
            function populateDashboard() {
                // Popula o resumo
                const summaryContainer = document.getElementById('summary-content');
                if (mockSummaryData) {
                    summaryContainer.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                            <div class="stat-card p-5 rounded-xl border-l-4 border-indigo-500">
                                <h3 class="text-sm font-medium text-gray-400 mb-1">Total de Alertas</h3>
                                <p class="text-3xl lg:text-4xl font-bold text-white">${mockSummaryData.total_alertas}</p>
                            </div>
                            <div class="stat-card p-5 rounded-xl border-l-4 border-red-500">
                                <h3 class="text-sm font-medium text-gray-400 mb-1">Risco Médio</h3>
                                <p class="text-3xl lg:text-4xl font-bold text-white">${mockSummaryData.risco_medio.toFixed(2)}</p>
                            </div>
                            <div class="stat-card p-5 rounded-xl border-l-4 border-yellow-500">
                                <h3 class="text-sm font-medium text-gray-400 mb-1">Ineficiência Média</h3>
                                <p class="text-3xl lg:text-4xl font-bold text-white">${mockSummaryData.ineficiencia_media.toFixed(2)}</p>
                            </div>
                            <div class="stat-card p-5 rounded-xl border-l-4 border-cyan-500">
                                <h3 class="text-sm font-medium text-gray-400 mb-1">Impacto Médio</h3>
                                <p class="text-3xl lg:text-4xl font-bold text-white">${mockSummaryData.impacto_medio.toFixed(2)}</p>
                            </div>
                        </div>`;
                } else {
                    summaryContainer.innerHTML = `<div class="text-center py-8"><p class="text-gray-400">Nenhum dado de análise encontrado. Envie um arquivo para gerar o primeiro relatório.</p></div>`;
                }

                // Popula os links
                const linksContainer = document.querySelector('.side-links');
                const colorMap = { red: 'border-red-500 text-red-500', green: 'border-green-500 text-green-500', gray: 'border-gray-500 text-gray-500' };
                linksContainer.innerHTML = mockLinks.map(link => `
                    <a href="${link.url}" target="_blank" class="side-card card p-4 rounded-xl flex items-center gap-4 hover:border-indigo-500 hover:-translate-y-1 transition-all duration-300 border-l-4 ${colorMap[link.color]}">
                        <div class="icon ${colorMap[link.color]}">${link.icon}</div>
                        <div>
                            <h3 class="font-semibold text-white leading-tight">${link.title}</h3>
                            <p class="text-sm text-gray-400">${link.description}</p>
                        </div>
                    </a>
                `).join('');
            }

            // --- INICIALIZAÇÃO ---
            populateDashboard();
            setupFileInput();
            showView('dashboard'); // Define a tela inicial
        });
    </script>
</body>
</html>
